---
import { getCollection } from "astro:content";
const languages = await getCollection("languages");
const allLanguagesSlugs = languages.map((entry) => entry.slug);
---

<random-language-button data-slugs={allLanguagesSlugs}>
  <a
    role="button"
    id="randomLanguage"
    class="btn mb-4 mt-2 btn-primary"
    href="/">Go to other random langugage</a
  >
  <input type="checkbox" hidden />
</random-language-button>

<script>
  // define the custom element
  class RandomLanguageButton extends HTMLElement {
    private allowLocalStorage = false;
    private slugs: string[] = [];

    constructor() {
      super();
      const button = this.querySelector("#randomLanguage");
      const input = this.querySelector("input");
      input?.removeAttribute("hidden");
      this.slugs = this.getAttribute("data-slugs")?.split(",") || [];
      if (!button) {
        return;
      }
      button.addEventListener("click", (e) => {
        e.preventDefault();
        const randomSlug = this.getRandomSlug(this.slugs);
        window.location.href = `/${randomSlug}`;
      });
    }
    getRandomSlug(slugs: string[]) {
      return slugs[Math.floor(Math.random() * slugs.length)];
    }
  }
  customElements.define("random-language-button", RandomLanguageButton);
</script>
