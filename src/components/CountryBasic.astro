---
import type { CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";
import { randomSorting } from "@/helpers/randomSorting";
import RandomLanguageButton from "@/components/RandomLanguageButton.astro";

const images = import.meta.glob<{ default: ImageMetadata }>(
  "/src/images/*.{jpeg,jpg,png,gif}",
);

interface Props {
  language: CollectionEntry<"languages">;
}
const { language } = Astro.props;
const Flags: any = language.data.flags
  .map((flag: string) => `flag-${flag}`)
  .sort(randomSorting);
const image = images["/src/images/" + language.slug + ".jpg"];
---

<section class="container my-8 flex flex-col gap-8 items-center">
  <div class="flex gap-2 items-center justify-center">
    {
      Flags.map((Flag: any) => {
        return <Flag style="height: 30px;width:40px" />;
      })
    }
  </div>
  <p class="withFlag text-xl flex items-center gap-2">
    in {language.data.languageName["en"]} we say:
  </p>
  <blockquote>
    <h2 class="text-4xl italic">"{language.data.original}"</h2>
  </blockquote>
  <span>which means literally:</span>
  <p class="text-2xl">{language.data.meaning["en"]}</p>
  <RandomLanguageButton currentSlug={language.slug} />

  {
    image && (
      <Image
        class="max-w-lg"
        src={image()}
        alt={`Dall-e generated image illustrating a prompt: ${language.data.meaning["en"]}`}
      />
    )
  }
</section>
<section class="container max-w-screen-md mx-auto my-12 flex flex-col gap-8">
  {
    language.body.length > 10 && (
      <>
        <h3 class="text-2xl mb-2">More about this saying</h3>
        <article class="prose">{language.body}</article>
      </>
    )
  }

  <p class="mt-8 text-sm">
    <span>Permalink to this saying:</span>
    <a href={`/${language.slug}`}>
      {`/${language.slug}`}
    </a>
  </p>
</section>

<script>
  import "../scripts/elements.flagmeister.js";
</script>
